@using Microsoft.IdentityModel.Tokens
@using OthelloProject.Models.Methods
@using System.Diagnostics.Eventing.Reader
@model List<GameDetails>

@{
    ViewData["Title"] = "Inloggad";
}

<div class="othello-form" style="max-width: 760px;">
    <div class="mb-3 text-center">
        <h1 class="display-6 mb-2">Available games</h1>
        <p class="mb-0 text-muted">Create a new game or join an existing one.</p>
    </div>

    @if (Model.IsNullOrEmpty())
    {
        <h5 class="text-center">@ViewBag.NoGames</h5>
    }
    else
    {
        <div class="d-flex flex-nowrap justify-content-between align-items-center gap-3 mb-4 mt-5">
            <form method="get"
                  asp-action="Games"
                  asp-controller="Games"
                  class="d-flex flex-nowrap gap-2 justify-content-start align-items-center mb-0 flex-grow-1">
                <input type="text"
                       name="search"
                       placeholder="Search by game name"
                       class="othello-input"
                       style="max-width: 240px;"
                       value="@Context.Request.Query["search"]" />
                <button type="submit" value="search" class="othello-btn">
                    Search
                </button>
                @if (ViewBag.Sorted == true)
                {
                    <a asp-controller="Games"
                       asp-action="Games"
                       asp-route-sorted="false"
                       class="othello-btn-back">
                        Unsort
                    </a>
                }
                else
                {
                    <a asp-controller="Games"
                       asp-action="Games"
                       asp-route-sorted="true"
                       class="othello-btn-back">
                        Sort by availability
                    </a>
                }
            </form>

            <a type="submit"
               class="othello-btn"
               asp-controller="Games"
               asp-action="AddGame">
                +
            </a>
        </div>

        <table class="othello-table mb-3">
            <tr>
                <th class="othello-label text-center">Player</th>
                <th class="othello-label text-center">Status</th>
                <th class="othello-label text-center" style="white-space: nowrap;">Join</th>
            </tr>

            @foreach (GameDetails availableGames in Model)
            {
                <tr>
                    <td class="text-center">@availableGames.GameName</td>
                    <td class="text-center">@availableGames.GameStatus</td>
                    <td class="text-center" style="white-space: nowrap;">
                        @if (availableGames.GameStatus == "Waiting")
                        {
                            <a type="submit"
                               class="othello-nav-link"
                               asp-controller="Games"
                               asp-action="JoinGame"
                               asp-route-GameID="@availableGames.GameID">
                                Join Game
                            </a>
                        }
                        else
                        {
                            <span>Game in progress</span>
                        }
                    </td>
                </tr>
            }
        </table>
    }

</div>
